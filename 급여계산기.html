<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì§ì›ë³„ ê¸‰ì—¬ ìë™ ê³„ì‚°ê¸°</title>
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <style>
        /* ------------------ CSS ìŠ¤íƒ€ì¼ë§ (ìµœì¢…) ------------------ */
        :root {
            --primary-color: #0d9488;
            --secondary-color: #f0fdfa;
            --border-color: #e2e8f0;
            --header-color: #1e293b;
            --weekend-color-sat: #3b82f6;
            --weekend-color-sun: #ef4444;
            --total-sum-bg: #fffbe6;
            --total-sum-color: #d97706;
            --pay-box-bg: #f8fafc;
        }
        body {
            font-family: 'Pretendard', sans-serif;
            background-color: #f4f7f6;
            margin: 0;
            padding: 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .main-container {
            display: flex;
            gap: 30px;
            width: 95%;
            max-width: 1400px;
            margin-top: 20px;
        }
        .container {
            background-color: #ffffff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        }
        #input-area { width: 55%; }
        #output-area { width: 40%; }
        
        /* íƒ­ ìŠ¤íƒ€ì¼ */
        .tabs { display: flex; margin-bottom: 20px; border-bottom: 3px solid var(--border-color); }
        .tab-button {
            padding: 12px 20px; cursor: pointer; border: none; background-color: #f8fafc;
            color: #475569; font-weight: 600; font-size: 16px; border-top-left-radius: 8px;
            border-top-right-radius: 8px; transition: all 0.2s; margin-right: 5px;
        }
        .tab-button.active {
            background-color: #ffffff; color: var(--primary-color); border: 3px solid var(--border-color); border-bottom: none;
        }
        .summary-tab { background-color: #e0f2f1; color: #0d9488; font-size: 1.1em; font-weight: 800; margin-right: 15px; }
        .summary-tab.active { background-color: #ccfbf1; color: #0f766e; }
        .settings-tab { margin-right: 15px; }

        /* ì…ë ¥ ì˜ì—­ ë° ë“œë¡­ë‹¤ìš´ */
        .input-header { 
            display: flex; align-items: center; font-weight: 800; color: var(--header-color); 
            border-bottom: 2px solid var(--border-color); padding-bottom: 10px; margin-bottom: 20px;
        }
        .input-header h2 { margin: 0; font-size: 1.5em; flex-grow: 1; }
        .input-header select { padding: 8px; border: 1px solid var(--border-color); border-radius: 6px; font-size: 16px; margin-left: 10px;}
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        /* ë‹¬ë ¥ í…Œì´ë¸” ìŠ¤íƒ€ì¼ ìœ ì§€ */
        #time-input-table { width: 100%; border-collapse: collapse; text-align: center; font-size: 14px; }
        #time-input-table th, #time-input-table td { padding: 8px 4px; border: 1px solid var(--border-color); }
        .day-label { width: 10%; font-weight: 600; }
        .day-label.sun { color: var(--weekend-color-sun); }
        .day-label.sat { color: var(--weekend-color-sat); }
        #time-input-table td:first-child, #time-input-table td:nth-child(2) { width: 10%; }
        #time-input-table input { width: 90%; padding: 4px; border: 1px solid #cbd5e1; border-radius: 4px; text-align: center; font-size: 13px; }

        /* ì„¤ì • í…Œì´ë¸” ìŠ¤íƒ€ì¼ ìœ ì§€ */
        #settings-table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 16px; }
        #settings-table th, #settings-table td { padding: 12px 15px; border: 1px solid var(--border-color); text-align: left; }
        #settings-table th { background-color: var(--secondary-color); font-weight: 700; }
        #settings-table input { width: 90%; padding: 8px; border: 1px solid #cbd5e1; border-radius: 4px; font-size: 16px; text-align: right;}
        #settings-table td:nth-child(3) { font-weight: 800; color: var(--primary-color); text-align: right; }
        
        /* ------------------ A. ì¢…í•© ìš”ì•½ í…Œì´ë¸” ìŠ¤íƒ€ì¼ (ìº¡ì²˜ 1 ë°˜ì˜) ------------------ */
        #summary-view-content .input-header { 
            justify-content: flex-end; 
            padding-bottom: 0;
            border-bottom: none;
        }
        #summary-view-content .title-display { 
            font-size: 1.3em;
            font-weight: 800;
            color: var(--primary-color);
            margin-top: 10px;
            padding-bottom: 10px;
            border-bottom: 1px dashed var(--border-color);
        }
        #summary-data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 16px;
            margin-top: 15px;
        }
        #summary-data-table th, #summary-data-table td {
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            text-align: center;
        }
        #summary-data-table thead th {
            background-color: var(--primary-color);
            color: white;
            font-weight: 700;
        }
        #summary-data-table tbody tr:last-child {
            font-weight: 900;
            background-color: var(--total-sum-bg);
            color: var(--total-sum-color);
            border-top: 3px solid var(--total-sum-color);
            font-size: 1.1em;
        }

        /* ------------------ B. ì§ì› ìƒì„¸ ëª…ì„¸í‘œ (ìº¡ì²˜ 2 ë°˜ì˜) ------------------ */
        #employee-detail-view h2 {
            font-weight: 800; color: var(--header-color); border-bottom: 2px solid var(--border-color); padding-bottom: 10px; margin-bottom: 20px;
        }
        .employee-info {
            font-size: 1.5em; font-weight: 800; color: var(--primary-color); margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px dashed var(--border-color);
        }
        #detail-pay-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        #detail-pay-table th, #detail-pay-table td {
            padding: 10px 15px;
            border: 1px solid var(--border-color);
            font-size: 15px;
        }
        #detail-pay-table th {
            background-color: var(--pay-box-bg);
            font-weight: 600;
            width: 40%;
        }
        #detail-pay-table td {
            text-align: right;
            font-weight: 700;
            color: var(--header-color);
        }
        .summary-box {
            background-color: #f0fdfa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
        }
        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        .summary-row span:last-child {
            font-weight: 900;
            color: var(--primary-color);
        }
        .total-pay-row th, .total-pay-row td {
            background-color: #ccfbf1 !important;
            font-weight: 900 !important;
            color: #0f766e !important;
            font-size: 1.1em;
        }

        /* ------------------ C. ëª¨ë‹¬ ìŠ¤íƒ€ì¼ ì¶”ê°€ ------------------ */
        .modal {
            display: none; /* ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê¹€ */
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4); /* ë°°ê²½ ì–´ë‘¡ê²Œ ì²˜ë¦¬ */
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: #fff;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            width: 90%;
            max-width: 350px;
            text-align: center;
        }

        .modal-content h3 {
            color: var(--primary-color);
            font-size: 1.2em;
            margin-top: 0;
            margin-bottom: 15px;
        }
        
        .modal-content p {
            font-size: 1.0em;
            color: var(--header-color);
            margin-bottom: 25px;
        }

        .modal-button {
            background-color: var(--primary-color);
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 600;
            transition: background-color 0.2s;
        }

        .modal-button:hover {
            background-color: #07796d;
        }

    </style>
</head>
<body>
    <h1>âœ… ì§ì›ë³„ & ì¢…í•© ê¸‰ì—¬ ìë™ ê³„ì‚°ê¸° (FINAL)</h1> 

    <div class="tabs">
        <button class="tab-button summary-tab" onclick="showSummary()">ì¢…í•© ìš”ì•½</button>
        <button class="tab-button settings-tab" onclick="showSettings()">ì„¤ì •</button>
        <button class="tab-button" onclick="changeEmployee('ì´íš¨ì„±')">ì´íš¨ì„±</button>
        <button class="tab-button" onclick="changeEmployee('ì •ìˆ˜ì—°')">ì •ìˆ˜ì—°</button>
        <button class="tab-button" onclick="changeEmployee('ì‹ ì¤€ì‹')">ì‹ ì¤€ì‹</button>
        <button class="tab-button" onclick="changeEmployee('ë°•ìˆ˜í˜„')">ë°•ìˆ˜í˜„</button>
    </div>

    <div class="main-container">
        <div id="input-area" class="container">
            <div class="save-section">
                <button id="save-button" onclick="saveData()">ë°ì´í„° ì €ì¥ (ë‚´ PC)</button>
            </div>

            <div id="employee-input-view" class="tab-content">
                <div class="input-header">
                    <h2>ğŸ—“ ê·¼íƒœ ê¸°ë¡ ì…ë ¥</h2>
                    <select id="year-select" onchange="changeYear()">
                        <option value="2025">2025ë…„</option>
                        <option value="2026">2026ë…„</option>
                        <option value="2027">2027ë…„</option>
                    </select>
                    <select id="month-select" onchange="changeMonth()"></select>
                </div>
                <p style="color: red;">* ì¶œê·¼/í‡´ê·¼ ì‹œê°„ì„ **HH:MM** í˜•ì‹ìœ¼ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”. (ì˜ˆ: 09:00, 18:30)</p>
                
                <table id="time-input-table">
                    <thead>
                        <tr>
                            <th style="width: 10%;">ë‚ ì§œ</th>
                            <th style="width: 10%;">ìš”ì¼</th>
                            <th style="width: 25%;">ì¶œê·¼</th>
                            <th style="width: 25%;">í‡´ê·¼</th>
                            <th style="width: 30%;">ì¼ë³„ ê·¼ë¬´</th>
                        </tr>
                    </thead>
                    <tbody>
                        </tbody>
                </table>
            </div>

            <div id="summary-view-content" class="tab-content">
                <div class="input-header">
                    <select id="summary-year-select" onchange="changeSummaryYear()">
                        <option value="2025">2025ë…„</option>
                        <option value="2026">2026ë…„</option>
                        <option value="2027">2027ë…„</option>
                    </select>
                    <select id="summary-month-select" onchange="changeSummaryMonth()"></select>
                </div>

                <div class="title-display">ê·¼ë¬´ ëŒ€ìƒ ì›”: <span id="summary-month-display">2025ë…„ 1ì›”</span></div>

                <table id="summary-data-table">
                    <thead>
                        <tr>
                            <th>ì§ì› ì´ë¦„</th>
                            <th>ì´ ê·¼ë¬´ ì‹œê°„</th>
                            <th>ì´ ì¶œê·¼ ì¼ìˆ˜</th>
                            <th>ì´ ì§€ê¸‰ í•©ê³„</th>
                        </tr>
                    </thead>
                    <tbody id="summary-table-body">
                        </tbody>
                </table>
            </div>
            
            <div id="settings-input-view" class="tab-content">
                <div class="input-header">
                    <h2>âš™ï¸ ì—°ë„ë³„ ìµœì €ì‹œê¸‰ ì„¤ì •</h2>
                </div>
                <p style="color: red;">* ì‹œê¸‰ì„ ì…ë ¥í•˜ì‹œë©´ ë¶„ë‹¹ ê¸ˆì•¡ì´ ìë™ ê³„ì‚°ë©ë‹ˆë‹¤. </p>
                <table id="settings-table">
                    <thead>
                        <tr>
                            <th>ì—°ë„</th>
                            <th style="width: 35%;">ìµœì €ì‹œê¸‰ (ì›)</th>
                            <th style="width: 35%;">ë¶„ë‹¹ ê¸ˆì•¡ (ì›)</th>
                        </tr>
                    </thead>
                    <tbody id="settings-table-body">
                        </tbody>
                </table>
                <p style="font-size: 1.1em; color: #ef4444; font-weight: 700; margin-top: 20px;">
                    ì£¼ì˜: ì‹œê¸‰ ì„¤ì • í›„ì—ëŠ” ë°˜ë“œì‹œ ì¢Œì¸¡ ìƒë‹¨ì˜ 'ë°ì´í„° ì €ì¥' ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì…”ì•¼ ë°˜ì˜ë©ë‹ˆë‹¤.
                </p>
            </div>
            
            </div>

        <div id="output-area" class="container">
            
            <div id="employee-detail-view" class="tab-content">
                <h2>ğŸ’° ê¸‰ì—¬ ì •ë³´</h2>
                <div class="employee-info"><span id="current-employee-name">ì´íš¨ì„±</span> ë‹˜ì˜ ëª…ì„¸</div>
                
                <div class="summary-box">
                    <div class="summary-row">
                        <span>ê·¼ë¬´ ëŒ€ìƒ ì›”:</span>
                        <span id="target-month">2025ë…„ 1ì›”</span>
                    </div>
                    <div class="summary-row">
                        <span>ì´ ê·¼ë¬´ ì‹œê°„:</span>
                        <span id="total-time">0ì‹œê°„ 0ë¶„</span>
                    </div>
                    <div class="summary-row">
                        <span>ì´ ì¶œê·¼ ì¼ìˆ˜:</span>
                        <span id="total-days">0ì¼</span>
                    </div>
                    <div class="summary-row">
                        <span>ì ìš© ë¶„ë‹¹ ê¸ˆì•¡:</span>
                        <span id="rate-per-min-display">0ì›</span>
                    </div>
                </div>

                <table id="detail-pay-table">
                    <tbody>
                        <tr><th>ê¸‰ì—¬ì•¡</th><td id="pay-amount">0ì›</td></tr>
                        <tr><th>ì‹ëŒ€ (ì¶œê·¼ì¼ìˆ˜ x 8,000ì›)</th><td id="meal-allowance">0ì›</td></tr>
                        <tr class="total-pay-row"><th>ì´ ì§€ê¸‰ í•©ê³„</th><td id="total-pay">0ì›</td></tr>
                    </tbody>
                </table>
            </div>

            <div id="settings-view" class="tab-content">
                <p style="font-size: 1.5em; color: var(--header-color); font-weight: 800;">
                    ì‹œê¸‰ ì„¤ì •ì„ ìœ„í•œ ì˜ì—­ì…ë‹ˆë‹¤.
                </p>
            </div>
        </div>
    </div>

    <div id="saveModal" class="modal">
        <div class="modal-content">
            <h3>âœ… ë°ì´í„° ì €ì¥ ì™„ë£Œ</h3>
            <p>ì§ì› ê·¼ë¬´ ê¸°ë¡ ë° ì‹œê¸‰ ì„¤ì •ì´<br>ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
            <button class="modal-button" onclick="closeModal()">í™•ì¸</button>
        </div>
    </div>


    <script>
        // ìƒìˆ˜ ì •ì˜
        const EMPLOYEES = ['ì´íš¨ì„±', 'ì •ìˆ˜ì—°', 'ì‹ ì¤€ì‹', 'ë°•ìˆ˜í˜„'];
        const MEAL_ALLOWANCE = 8000;
        const WEEKDAYS = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
        const YEARS = [2025, 2026, 2027];
        
        const EMPLOYEE_DATA_KEY_PREFIX = 'payrollData_'; 
        const RATES_STORAGE_KEY = 'annualPayRates'; 

        let employeeData = {};
        let yearlyRates = {};
        let calculatedResults = {};
        let currentEmployee = EMPLOYEES[0];
        let currentYear = 2025;
        let currentMonth = 1;

        // --- CORE UTILITIES ---
        function getDaysInMonth(year, month) {
            return new Date(year, month, 0).getDate();
        }
        function calculatePayPerMinute(hourlyWage) {
            if (!hourlyWage || hourlyWage <= 0) return 0;
            const rate = hourlyWage / 60;
            return Math.trunc(rate * 10) / 10; 
        }

        // --- DATA MANAGEMENT ---
        function loadAndInitRates() {
            yearlyRates = {};
            const savedRates = localStorage.getItem(RATES_STORAGE_KEY);
            const defaultHourly = { 2025: 10030, 2026: 11000, 2027: 12000 }; 

            YEARS.forEach(year => {
                let hourly = defaultHourly[year] || 0;
                if (savedRates) {
                    try {
                        const parsedRates = JSON.parse(savedRates);
                        if (parsedRates[year] && parsedRates[year].hourly) {
                            hourly = parsedRates[year].hourly;
                        }
                    } catch (e) { }
                }
                yearlyRates[year] = {
                    hourly: hourly,
                    payPerMinute: calculatePayPerMinute(hourly)
                };
            });
        }
        
        function initializeData(year) {
            employeeData = {};
            calculatedResults = {};

            // 1. ì´ˆê¸° ë°ì´í„° êµ¬ì¡° ìƒì„± (GitHub Pagesì—ì„œ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ê°€ ë¹„ì–´ìˆì–´ë„ êµ¬ì¡°ë¥¼ ë§Œë“¦)
            EMPLOYEES.forEach(name => {
                employeeData[name] = {};
                calculatedResults[name] = {};
                for (let month = 1; month <= 12; month++) {
                    const daysInMonth = getDaysInMonth(year, month);
                    calculatedResults[name][month] = { totalMinutes: 0, totalDays: 0, totalPay: 0 };
                    employeeData[name][month] = {};
                    for (let day = 1; day <= daysInMonth; day++) {
                        employeeData[name][month][day] = { start: '', end: '' };
                    }
                }
            });

            // 2. ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ë°ì´í„° ë¡œë“œ (ë¡œì»¬ í™˜ê²½ì—ì„œë§Œ ë™ì‘)
            const savedData = localStorage.getItem(EMPLOYEE_DATA_KEY_PREFIX + year);
            if (savedData) {
                try {
                    const parsedData = JSON.parse(savedData);
                    Object.keys(parsedData).forEach(employee => {
                        if (employeeData[employee]) {
                            // Object.assignì„ ì‚¬ìš©í•˜ì—¬ ê¸°ì¡´ì˜ ì´ˆê¸°í™”ëœ êµ¬ì¡°ë¥¼ ìœ ì§€í•˜ë©´ì„œ ë°ì´í„° ë³‘í•©
                            Object.keys(parsedData[employee]).forEach(month => {
                                if (employeeData[employee][month]) {
                                    Object.assign(employeeData[employee][month], parsedData[employee][month]);
                                }
                            });
                        }
                    });
                } catch (e) {
                    console.error(year + "ë…„ ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", e);
                }
            }
        }
        
        // --- MODAL FUNCTIONS ---
        function openModal() {
            const modal = document.getElementById('saveModal');
            modal.style.display = 'flex';
        }

        function closeModal() {
            const modal = document.getElementById('saveModal');
            modal.style.display = 'none';
        }

        // --- DATA SAVE FUNCTION (Modified) ---
        function saveData() {
            try {
                // ë°ì´í„° ì €ì¥ ìì²´ëŠ” localStorageë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ GitHub Pagesì—ì„œë„ ì‘ë™í•¨ (ì ‘ì†í•œ ë¸Œë¼ìš°ì €ì— ì €ì¥ë¨)
                localStorage.setItem(EMPLOYEE_DATA_KEY_PREFIX + currentYear, JSON.stringify(employeeData));
                localStorage.setItem(RATES_STORAGE_KEY, JSON.stringify(yearlyRates));

                // ì €ì¥ ì„±ê³µ ì‹œ ëª¨ë‹¬ ì°½ í‘œì‹œ
                openModal(); 

            } catch (e) {
                alert("ë°ì´í„° ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì„¤ì •(í”„ë¼ì´ë²„ì‹œ ëª¨ë“œ)ì„ í™•ì¸í•´ì£¼ì„¸ìš”.");
                console.error("ë°ì´í„° ì €ì¥ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", e);
            }
        }

        // --- VIEW CONTROL UTILITIES ---
        function hideAllViews() {
            // ì¢Œì¸¡ ë·°
            document.getElementById('employee-input-view').classList.remove('active');
            document.getElementById('settings-input-view').classList.remove('active');
            document.getElementById('summary-view-content').classList.remove('active');
            
            // ìš°ì¸¡ ë·°
            document.getElementById('employee-detail-view').classList.remove('active');
            document.getElementById('settings-view').classList.remove('active');
        }

        // --- DROPDOWN SETUP ---
        function createMonthSelect(targetSelectId, initialMonth) {
            const select = document.getElementById(targetSelectId);
            select.innerHTML = '';
            for (let month = 1; month <= 12; month++) {
                const option = document.createElement('option');
                option.value = month;
                option.textContent = `${month}ì›”`;
                select.appendChild(option);
            }
            select.value = initialMonth;
        }

        // --- CALCULATIONS ---
        function calculatePay(employee, month) {
            let totalMinutes = 0;
            let totalDays = 0;
            const daysInMonth = getDaysInMonth(currentYear, month);
            const monthData = employeeData[employee][month];
            
            const currentRate = yearlyRates[currentYear]?.payPerMinute || 0; 
            
            for (let day = 1; day <= daysInMonth; day++) {
                const startInput = monthData[day]?.start;
                const endInput = monthData[day]?.end;
                
                let dailyMinutes = 0;

                if (startInput && endInput && startInput.match(/^\d{1,2}:\d{2}$/) && endInput.match(/^\d{1,2}:\d{2}$/)) {
                    
                    const [startHour, startMinute] = startInput.split(':').map(Number);
                    const [endHour, endMinute] = endInput.split(':').map(Number);

                    const startTimeInMin = startHour * 60 + startMinute;
                    const endTimeInMin = endHour * 60 + endMinute;

                    dailyMinutes = endTimeInMin - startTimeInMin;

                    if (dailyMinutes > 0) {
                        totalMinutes += dailyMinutes;
                        totalDays++;

                        if (employee === currentEmployee && month === currentMonth && document.getElementById('employee-input-view').classList.contains('active')) {
                             const hours = Math.floor(dailyMinutes / 60);
                             const minutes = dailyMinutes % 60;
                             document.getElementById(`daily-work-${day}`).textContent = `${hours}h ${minutes}m`;
                        }

                    } else if (employee === currentEmployee && month === currentMonth && document.getElementById('employee-input-view').classList.contains('active')) {
                         document.getElementById(`daily-work-${day}`).textContent = 'ERROR';
                    }
                } else if (employee === currentEmployee && month === currentMonth && document.getElementById('employee-input-view').classList.contains('active')) {
                    document.getElementById(`daily-work-${day}`).textContent = '';
                }
            }
            
            const payAmount = Math.round(totalMinutes * currentRate);
            const mealAllowance = totalDays * MEAL_ALLOWANCE;
            const totalPay = payAmount + mealAllowance;

            calculatedResults[employee][month] = { 
                totalMinutes: totalMinutes, 
                totalDays: totalDays, 
                totalPay: totalPay
            };

            // ê·¼íƒœ ì…ë ¥ ë·°ê°€ í™œì„±í™”ëœ ê²½ìš°ì—ë§Œ ìš°ì¸¡ ìƒì„¸ ë·° ì—…ë°ì´íŠ¸
            if (employee === currentEmployee && month === currentMonth && document.getElementById('employee-input-view').classList.contains('active')) {
                updateEmployeeDetailView(totalMinutes, totalDays, payAmount, mealAllowance, totalPay, currentRate);
            }
            
            return { totalMinutes, totalDays, totalPay }; // ì¢…í•© ìš”ì•½ì„ ìœ„í•´ ê²°ê³¼ ë°˜í™˜
        }


        // --- UI UPDATES ---
        function updateEmployeeDetailView(totalMinutes, totalDays, payAmount, mealAllowance, totalPay, currentRate) {
            const totalHours = Math.floor(totalMinutes / 60);
            const remainingMinutes = totalMinutes % 60;
            
            document.getElementById('target-month').textContent = `${currentYear}ë…„ ${currentMonth}ì›”`;
            document.getElementById('rate-per-min-display').textContent = `${currentRate.toFixed(1)}ì›`;
            document.getElementById('total-time').textContent = `${totalHours}ì‹œê°„ ${remainingMinutes}ë¶„`;
            document.getElementById('total-days').textContent = `${totalDays}ì¼`;

            document.getElementById('pay-amount').textContent = `${payAmount.toLocaleString()}ì›`;
            document.getElementById('meal-allowance').textContent = `${mealAllowance.toLocaleString()}ì›`;
            document.getElementById('total-pay').textContent = `${totalPay.toLocaleString()}ì›`;
        }

        function updateCalendar() {
            const daysInMonth = getDaysInMonth(currentYear, currentMonth);
            const timeInputTableBody = document.getElementById('time-input-table').querySelector('tbody');
            timeInputTableBody.innerHTML = '';

            const currentMonthData = employeeData[currentEmployee][currentMonth];

            for (let day = 1; day <= daysInMonth; day++) {
                const row = timeInputTableBody.insertRow();
                const start = currentMonthData[day]?.start || '';
                const end = currentMonthData[day]?.end || '';

                const date = new Date(currentYear, currentMonth - 1, day);
                const dayOfWeekIndex = date.getDay();
                const dayOfWeekText = WEEKDAYS[dayOfWeekIndex];
                
                let dayClass = '';
                if (dayOfWeekIndex === 0) { dayClass = 'sun'; } 
                else if (dayOfWeekIndex === 6) { dayClass = 'sat'; }

                row.innerHTML = `
                    <td>${day}ì¼</td>
                    <td class="day-label ${dayClass}">${dayOfWeekText}</td>
                    <td><input type="text" data-day="${day}" data-type="start" value="${start}" oninput="handleInputChange(this)"></td>
                    <td><input type="text" data-day="${day}" data-type="end" value="${end}" oninput="handleInputChange(this)"></td>
                    <td id="daily-work-${day}" style="font-weight: 500;"></td>
                `;
            }

            calculatePay(currentEmployee, currentMonth);
        }

        function updateSettingsView() {
            const tableBody = document.getElementById('settings-table-body');
            tableBody.innerHTML = '';
            
            YEARS.forEach(year => {
                const row = tableBody.insertRow();
                const data = yearlyRates[year];

                row.innerHTML = `
                    <td>${year}ë…„</td>
                    <td><input type="number" data-year="${year}" value="${data.hourly}" oninput="handleRateChange(this)"></td>
                    <td id="rate-per-min-${year}">${data.payPerMinute.toFixed(1)}ì›</td>
                `;
            });
        }
        
        function updateSummaryView() {
            const summaryBody = document.getElementById('summary-table-body');
            summaryBody.innerHTML = '';

            let grandTotalMinutes = 0;
            let grandTotalDays = 0;
            let grandTotalPay = 0;

            document.getElementById('summary-month-display').textContent = `${currentYear}ë…„ ${currentMonth}ì›”`;

            EMPLOYEES.forEach(employee => {
                const result = calculatedResults[employee][currentMonth];

                grandTotalMinutes += result.totalMinutes;
                grandTotalDays += result.totalDays;
                grandTotalPay += result.totalPay;

                const row = summaryBody.insertRow();
                
                const totalHours = Math.floor(result.totalMinutes / 60);
                const remainingMinutes = result.totalMinutes % 60;

                row.innerHTML = `
                    <td>${employee}</td>
                    <td>${totalHours}ì‹œê°„ ${remainingMinutes}ë¶„</td>
                    <td>${result.totalDays}ì¼</td>
                    <td>${result.totalPay.toLocaleString()}ì›</td>
                `;
            });
            
            const totalRow = summaryBody.insertRow();
            totalRow.innerHTML = `
                <td>ì´ í•©ê³„</td>
                <td>${Math.floor(grandTotalMinutes / 60)}ì‹œê°„ ${grandTotalMinutes % 60}ë¶„</td>
                <td>${grandTotalDays}ì¼</td>
                <td>${grandTotalPay.toLocaleString()}ì›</td>
            `;
        }


        // --- HANDLERS ---
        function handleInputChange(inputElement) {
            const day = Number(inputElement.getAttribute('data-day'));
            const type = inputElement.getAttribute('data-type');
            
            // ì…ë ¥ê°’ ì €ì¥
            employeeData[currentEmployee][currentMonth][day][type] = inputElement.value;

            // ê¸‰ì—¬ ì¬ê³„ì‚° ë° ì—…ë°ì´íŠ¸
            calculatePay(currentEmployee, currentMonth);
        }

        function handleRateChange(inputElement) {
            const year = Number(inputElement.getAttribute('data-year'));
            const newHourly = Number(inputElement.value);

            const newRatePerMin = calculatePayPerMinute(newHourly);
            yearlyRates[year] = {
                hourly: newHourly,
                payPerMinute: newRatePerMin
            };

            document.getElementById(`rate-per-min-${year}`).textContent = `${newRatePerMin.toFixed(1)}ì›`;

            if (year === currentYear) {
                // ì‹œê¸‰ì´ ë³€ê²½ë˜ë©´ ëª¨ë“  ì§ì›ì˜ ê¸‰ì—¬ë¥¼ ë‹¤ì‹œ ê³„ì‚°
                EMPLOYEES.forEach(employee => calculatePay(employee, currentMonth));
                // ì¢…í•© ìš”ì•½ ë·°ê°€ í™œì„±í™”ë˜ì–´ ìˆë‹¤ë©´ ì—…ë°ì´íŠ¸
                if (document.getElementById('summary-view-content').classList.contains('active')) {
                    updateSummaryView();
                }
            }
        }


        // --- TAB & DROPDOWN CONTROLLERS ---
        
        function changeYear() {
            const newYear = Number(document.getElementById('year-select').value);
            
            if (newYear !== currentYear) {
                currentYear = newYear;
                initializeData(currentYear);
                updateCalendar();
            }
        }

        function changeMonth() {
            currentMonth = Number(document.getElementById('month-select').value);
            updateCalendar();
        }

        function changeSummaryYear() {
            currentYear = Number(document.getElementById('summary-year-select').value);
            initializeData(currentYear); 
            // ë°ì´í„° ë¡œë“œ í›„ ëª¨ë“  ì§ì›ì˜ ê¸‰ì—¬ë¥¼ ê³„ì‚°í•˜ì—¬ calculatedResultsë¥¼ ì—…ë°ì´íŠ¸
            EMPLOYEES.forEach(employee => calculatePay(employee, currentMonth));
            updateSummaryView();
        }

        function changeSummaryMonth() {
            currentMonth = Number(document.getElementById('summary-month-select').value);
            // ì›”ì´ ë³€ê²½ë˜ë©´ ëª¨ë“  ì§ì›ì˜ ê¸‰ì—¬ë¥¼ ê³„ì‚°
            EMPLOYEES.forEach(employee => calculatePay(employee, currentMonth));
            updateSummaryView();
        }


        // ì§ì› íƒ­ ë³€ê²½
        function changeEmployee(employeeName) {
            currentEmployee = employeeName;
            
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`.tab-button[onclick="changeEmployee('${employeeName}')"]`).classList.add('active');

            hideAllViews();
            
            // ì¢Œì¸¡: ê·¼íƒœ ì…ë ¥ í¼ (input-view)
            document.getElementById('employee-input-view').classList.add('active'); 
            // ìš°ì¸¡: ëª…ì„¸í‘œ (detail-view)
            document.getElementById('employee-detail-view').classList.add('active'); 

            // ë“œë¡­ë‹¤ìš´ ë™ê¸°í™”
            document.getElementById('year-select').value = currentYear;
            document.getElementById('month-select').value = currentMonth;
            
            document.getElementById('current-employee-name').textContent = employeeName;
            updateCalendar();
        }

        // ì„¤ì • íƒ­ í‘œì‹œ
        function showSettings() {
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`.tab-button[onclick="showSettings()"]`).classList.add('active');

            hideAllViews();
            
            // ì¢Œì¸¡: ì„¤ì • ì…ë ¥ í¼ (settings-input-view)
            document.getElementById('settings-input-view').classList.add('active'); 
            // ìš°ì¸¡: ì„¤ì • ë·° (settings-view)
            document.getElementById('settings-view').classList.add('active');

            updateSettingsView();
        }
        
        // ì¢…í•© ìš”ì•½ íƒ­ í‘œì‹œ
        function showSummary() {
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelector('.summary-tab').classList.add('active');

            hideAllViews();
            
            // ì¢Œì¸¡: ì¢…í•© ìš”ì•½ í…Œì´ë¸” (summary-view-content)
            document.getElementById('summary-view-content').classList.add('active'); 
            // ìš°ì¸¡: ë¹„í™œì„±í™” ìœ ì§€

            // ë“œë¡­ë‹¤ìš´ ë™ê¸°í™” ë° ê°•ì œ ì¬ê³„ì‚°
            document.getElementById('summary-year-select').value = currentYear;
            document.getElementById('summary-month-select').value = currentMonth;
            
            // í‘œì‹œ ì „ì— ëª¨ë“  ì§ì› ë°ì´í„°ë¥¼ ê³„ì‚°
            EMPLOYEES.forEach(employee => calculatePay(employee, currentMonth));
            updateSummaryView();
        }


        // --- INITIALIZATION ---
        window.onload = function() {
            loadAndInitRates();
            initializeData(currentYear);

            // ì´ˆê¸° ë“œë¡­ë‹¤ìš´ ì„¤ì •
            document.getElementById('year-select').value = currentYear; 
            document.getElementById('summary-year-select').value = currentYear; 
            
            createMonthSelect('month-select', currentMonth);
            createMonthSelect('summary-month-select', currentMonth);

            // ì´ˆê¸° ë·° ì„¤ì •ì„ ì¢…í•© ìš”ì•½ìœ¼ë¡œ ë³€ê²½
            showSummary(); 
        };
    </script>
</body>
</html>
